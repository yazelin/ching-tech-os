# 新增暫時性公開連結功能

## 目標
讓使用者可以產生暫時性的公開連結，分享知識庫或專案給未登入的人只讀查看。

## 動機
主要使用情境：
1. 在 Line Bot 對話中，AI 找到相關知識後，用戶希望分享給他人查看
2. Line 對話內容有長度限制，完整知識內容較長時不適合直接顯示
3. 需要臨時分享專案資訊給外部合作夥伴
4. 用戶從知識庫或專案管理頁面直接產生分享連結

## 解決方案概述

### 1. 資料庫
- 新增 `public_share_links` 表格儲存分享連結

### 2. 後端 API
- 沿用現有 API 架構風格
- 提供建立、查詢、撤銷公開連結的 API
- 提供無需登入的公開資源存取 API

### 3. 前端 - 公開頁面
- 新增 `/s/{token}` 公開頁面
- 無需登入即可查看知識庫或專案內容
- 支援附件下載和列印

### 4. 前端 - 知識庫/專案頁面分享按鈕
- 在知識庫內容區新增「分享」按鈕
- 在專案詳情區新增「分享」按鈕
- 點擊後彈出分享對話框（類似 Line 綁定碼彈窗）：
  - 選擇有效期（1 小時 / 24 小時 / 7 天 / 永久）
  - 顯示產生的短連結
  - 一鍵複製按鈕
  - QR Code 圖示

### 5. 前端 - 分享連結管理應用程式
- 新增「分享管理」桌面應用程式
- 註冊到 Taskbar/Dock
- 功能：
  - 列出所有分享連結（包含資源名稱、有效期、存取次數）
  - 即時刪除不再需要的連結
  - 按資源類型過濾（知識庫/專案）
  - 顯示連結狀態（有效/已過期）

### 6. Line Bot MCP 工具
- 新增 `create_share_link` 工具
- AI 可根據用戶需求產生分享連結

## 設計決策
- **短網址格式**：使用 `/s/{6字元token}` 格式，方便分享
- **預設有效期**：24 小時，用戶可選擇 1 小時、7 天或永久
- **只讀功能**：支援檢視、下載附件、列印
- **存取權限**：只有資源擁有者或有編輯權限的人可以建立公開連結
- **架構風格**：沿用現有 API/服務層架構，保持一致性

## 技術變更

### 資料庫
- 新增 Alembic migration
- 建立 `public_share_links` 表格

### 後端
- 新增 `api/share.py` - API 路由
- 新增 `services/share.py` - 業務邏輯
- 新增 `models/share.py` - Pydantic 資料模型
- 在 `main.py` 註冊路由

### 前端 - 公開頁面
- 新增 `public.html` - 公開頁面
- 新增 `js/public.js` - 公開頁面邏輯
- 新增 `css/public.css` - 公開頁面樣式

### 前端 - 分享管理應用程式
- 新增 `js/share-manager.js` - 分享管理應用程式
- 新增 `css/share-manager.css` - 分享管理樣式
- 在 `desktop.js` 註冊應用程式
- 在 `index.html` 和 `login.html` 引入 CSS/JS

### 前端 - 現有模組修改
- 修改 `js/knowledge-base.js` - 新增分享按鈕
- 修改 `js/project-manager.js` - 新增分享按鈕
- 新增共用的分享對話框組件

### Line Bot
- 在 `mcp_server.py` 新增 `create_share_link` 工具

### nginx
- 新增 `/s/{token}` rewrite 規則

## 影響範圍
- 新增獨立的公開頁面（不影響現有登入系統）
- 新增分享管理桌面應用程式
- 知識庫和專案管理 UI 新增分享按鈕
- Line Bot MCP Server 新增工具

## 不包含
- 公開連結的密碼保護（可後續擴充）
- 詳細的查看統計分析（僅記錄存取次數）
- 批量分享多個資源
