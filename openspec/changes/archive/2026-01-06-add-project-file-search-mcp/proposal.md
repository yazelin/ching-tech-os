# Proposal: NAS 共享檔案搜尋 MCP 工具

## Summary
新增 `search_nas_files` MCP 工具，讓 AI 助手能夠列出 NAS 共享掛載點（`/mnt/nas/projects`）中的檔案。支援關鍵字過濾（大小寫不敏感）、檔案類型過濾，回傳結果供 AI 進行語意匹配。用戶可進一步要求下載，系統透過 `create_share_link` 產生暫時下載連結。

## Motivation
用戶經常需要透過 Line Bot 詢問專案相關檔案，例如：
- 「找一下亦達 layout pdf」
- 「亦達時程規劃」

目前 AI 無法存取 NAS 上的專案檔案列表。透過此工具，AI 可以：
1. 列出符合條件的檔案
2. 從列表中進行語意匹配（例如「時程規劃」→「時間估算.xlsx」）
3. 回覆用戶正確的檔案路徑

## Approach
採用「MCP 列出 + AI 推理」方案：
1. MCP 工具負責列出檔案（安全、受控）
2. AI 負責從列表中語意匹配（智慧、彈性）

此方案簡單實作，不需建立索引或向量搜尋，同時利用 AI 的語意理解能力。

## Scope
- 新增 `search_nas_files` MCP 工具（搜尋 NAS 共享檔案）
- 新增 `get_nas_file_info` MCP 工具（取得檔案資訊）
- 擴充現有 `create_share_link` MCP 工具支援 `nas_file` 類型（產生下載連結）
- 工具僅能存取唯讀掛載的 `/mnt/nas/projects`
- 支援關鍵字過濾（路徑匹配，大小寫不敏感）
- 支援檔案類型過濾
- 限制回傳數量避免 token 爆炸
- 下載連結支援過期機制（預設 24 小時）

## Design Notes

### 權限模型

系統存在兩種 NAS 存取方式：

1. **用戶 SMB Session**：檔案管理器使用用戶自己的帳密連線 NAS，可存取用戶有權限的任何共享
2. **系統掛載點**：Line Bot、分享連結使用系統帳號的固定掛載點

分享連結必須使用系統掛載點讀取檔案，因此：
- 只有 `/mnt/nas/projects`（對應「擎添共用區/在案資料分享」）下的檔案可產生公開連結
- 用戶私人共享的檔案無法產生公開連結
- 檔案管理器需檢查路徑是否在可分享範圍內

```
用戶檔案管理器路徑                     系統掛載點              可分享？
────────────────────────────────────────────────────────────────────────
/擎添共用區/在案資料分享/...         → /mnt/nas/projects/...   ✓
/擎添開發/ching-tech-os/...         → /mnt/nas/ctos/...       ✓（未來可支援，本次不做）
/用戶私人共享/...                    → (無掛載)                ✗
```

### 回傳數量策略
- MCP 工具回傳最多 **100 筆**檔案給 AI（可調整）
- AI 進行語意匹配後，最多顯示 **5-10 個**最相關選項給用戶
- 如果結果仍太多，AI 應建議用戶提供更精確的關鍵字
- Line 訊息長度限制約 5000 字元，需考慮回覆格式

### 回覆格式範例
```
找到 3 個相關檔案：
1. /亦達光學/擎添資料/Layout/2024.1218 - 強化自動化配置.pdf
2. /亦達光學/擎添資料/Layout/2024.0925 - 初版設計.pdf
3. /亦達光學/Layout規格/總覽.pdf

請問要哪一個？
```

## Out of Scope
- 向量搜尋 / embedding 索引
- PDF 內容搜尋（僅搜尋檔名和路徑）
- 其他掛載點的檔案搜尋

## Risks
- 檔案數量過多時可能影響效能
- AI 語意匹配可能不準確（可接受，用戶可進一步描述）
