# Design: çµ±ä¸€æª”æ¡ˆæª¢è¦–å™¨æ¶æ§‹

## æ¶æ§‹æ¦‚è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FileOpener                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  open(filePath, filename?)                      â”‚   â”‚
â”‚  â”‚  - è‡ªå‹•åˆ¤æ–·æª”æ¡ˆé¡å‹                              â”‚   â”‚
â”‚  â”‚  - è·¯ç”±åˆ°å°æ‡‰çš„ Viewer                          â”‚   â”‚
â”‚  â”‚  - çµ±ä¸€è™•ç† API è·¯å¾‘è½‰æ›                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                             â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚         â–¼                 â–¼                 â–¼          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ImageViewer  â”‚  â”‚TextViewer   â”‚  â”‚PdfViewer    â”‚    â”‚
â”‚  â”‚Module       â”‚  â”‚Module       â”‚  â”‚Module       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â”‚                 â”‚                 â”‚          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                           â–¼                             â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚              â”‚  WindowModule       â”‚                   â”‚
â”‚              â”‚  (è¦–çª—ç®¡ç†)         â”‚                   â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## FileOpener çµ±ä¸€å…¥å£

### è·è²¬
1. æ ¹æ“šå‰¯æª”ååˆ¤æ–·æª”æ¡ˆé¡å‹
2. è·¯ç”±åˆ°å°æ‡‰çš„ Viewer æ¨¡çµ„
3. æä¾›çµ±ä¸€çš„ APIï¼Œéš±è—å„ Viewer å¯¦ä½œç´°ç¯€
4. æ”¯æ´è¨»å†Šæ–°çš„ Viewer é¡å‹ï¼ˆæ“´å±•æ€§ï¼‰

### API è¨­è¨ˆ

```javascript
const FileOpener = {
  // ä¸»è¦å…¥å£ï¼šé–‹å•Ÿæª”æ¡ˆ
  open(filePath, filename) { ... },

  // åˆ¤æ–·æ˜¯å¦æ”¯æ´æŸæª”æ¡ˆé¡å‹
  canOpen(filename) { ... },

  // å–å¾—æª”æ¡ˆå°æ‡‰çš„ Viewer é¡å‹
  getViewerType(filename) { ... },

  // è¨»å†Šæ–°çš„ Viewerï¼ˆæ“´å±•ç”¨ï¼‰
  registerViewer(type, config) { ... },

  // å…§å»ºçš„æª”æ¡ˆé¡å‹æ˜ å°„
  FILE_TYPES: {
    image: ['jpg', 'jpeg', 'png', 'gif', 'svg', 'webp', 'bmp', 'ico'],
    text: ['txt', 'md', 'json', 'yaml', 'yml', 'xml', 'html', 'css', 'js', 'py', 'log', 'ini', 'conf', 'sh', 'sql'],
    pdf: ['pdf']
  }
};
```

### ä½¿ç”¨æ–¹å¼

```javascript
// ç°¡å–®ç”¨æ³•ï¼šè‡ªå‹•åˆ¤æ–·é¡å‹
FileOpener.open('/api/files/123/download', 'document.pdf');
FileOpener.open('/nas/shared/image.png');

// åˆ¤æ–·æ˜¯å¦æ”¯æ´
if (FileOpener.canOpen('report.pdf')) {
  FileOpener.open(url, 'report.pdf');
}

// å–å¾— viewer é¡å‹
const type = FileOpener.getViewerType('image.png'); // 'image'
```

## Viewer æ¨¡çµ„å¥‘ç´„

æ¯å€‹ Viewer æ¨¡çµ„ SHALL å¯¦ä½œä»¥ä¸‹ä»‹é¢ï¼š

```javascript
const XxxViewerModule = {
  // é–‹å•Ÿæª¢è¦–å™¨
  open(filePath, filename) { ... },

  // é—œé–‰æª¢è¦–å™¨
  close() { ... }
};
```

### å…±åŒè¡Œç‚º
- è‹¥å·²æœ‰åŒé¡å‹è¦–çª—é–‹å•Ÿï¼Œé—œé–‰èˆŠè¦–çª—ä¸¦é–‹å•Ÿæ–°å…§å®¹
- ä½¿ç”¨ `WindowModule.createWindow()` å»ºç«‹è¦–çª—
- æ”¯æ´æš—è‰²/äº®è‰²ä¸»é¡Œåˆ‡æ›
- ç‹€æ…‹åˆ—é¡¯ç¤ºæª”æ¡ˆè³‡è¨Š

## PDF Viewer è¨­è¨ˆ

### ä¾è³´
- ä½¿ç”¨ [PDF.js](https://mozilla.github.io/pdf.js/) æ¸²æŸ“ PDF

### åŠŸèƒ½
1. é é¢å°èˆªï¼ˆä¸Š/ä¸‹é ã€è·³é ï¼‰
2. ç¸®æ”¾ï¼ˆæ”¾å¤§/ç¸®å°/é©åˆå¯¬åº¦/é©åˆé é¢ï¼‰
3. é¡¯ç¤ºç¸½é æ•¸å’Œç•¶å‰é ç¢¼
4. æ”¯æ´å¤§å‹ PDF çš„æ•ˆèƒ½å„ªåŒ–ï¼ˆåªæ¸²æŸ“å¯è¦‹é é¢ï¼‰

### UI çµæ§‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [â—€][â–¶] Page 1/10  [ğŸ”-][ğŸ”+][é©åˆ][100%]â”‚ â† å·¥å…·åˆ—
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚              PDF å…§å®¹å€                  â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ document.pdf                    1.2 MB  â”‚ â† ç‹€æ…‹åˆ—
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æª”æ¡ˆé¡å‹åˆ¤æ–·é‚è¼¯

```javascript
function getViewerType(filename) {
  const ext = filename.split('.').pop().toLowerCase();

  for (const [type, extensions] of Object.entries(FILE_TYPES)) {
    if (extensions.includes(ext)) {
      return type;
    }
  }

  return null; // ä¸æ”¯æ´çš„é¡å‹
}
```

## æ“´å±•æ–° Viewer

æœªä¾†è¦æ–°å¢ VideoViewer æ™‚ï¼š

```javascript
// 1. å»ºç«‹ VideoViewerModule
const VideoViewerModule = { open, close };

// 2. åœ¨ FileOpener è¨»å†Š
FileOpener.FILE_TYPES.video = ['mp4', 'webm', 'mov', 'avi'];
FileOpener.registerViewer('video', {
  module: VideoViewerModule,
  icon: 'file-video'
});
```

## å‘å¾Œç›¸å®¹

é‡æ§‹æœŸé–“ä¿æŒå‘å¾Œç›¸å®¹ï¼š
1. `ImageViewerModule.open()` å’Œ `TextViewerModule.open()` ç¹¼çºŒå¯ç”¨
2. é€æ­¥å°‡å„ app çš„èª¿ç”¨æ”¹ç‚º `FileOpener.open()`
3. å®Œæˆå¾Œï¼Œå„ Viewer çš„ `open()` ä»ä¿ç•™ä½œç‚ºå…§éƒ¨ API
