## Context

ç³»çµ±éœ€è¦çµ±ä¸€çš„ AI ç®¡ç†æ¶æ§‹ï¼Œæ”¯æ´ï¼š
1. å¤šç¨® AI åŠ©æ‰‹å ´æ™¯ï¼ˆå‰ç«¯å°è©±ã€Line Botã€ç³»çµ±æ’ç¨‹ï¼‰
2. å‹•æ…‹ç®¡ç† Promptsï¼ˆä¸éœ€é‡æ–°éƒ¨ç½²å³å¯èª¿æ•´ï¼‰
3. AI èª¿ç”¨æ—¥èªŒè¨˜éŒ„ï¼ˆé–‹ç™¼åé¥‹ã€prompt å„ªåŒ–ä¾æ“šï¼‰

**ç¾æœ‰ç‹€æ³ï¼š**
- AI åŠ©æ‰‹å‰ç«¯å·²å¯¦ä½œå°è©±åŠŸèƒ½ï¼ˆ`ai-assistant-ui`ï¼‰
- å°è©±è¨˜éŒ„å­˜æ–¼ `ai_chats` è¡¨
- Prompt åŸè¨­è¨ˆç‚ºæª”æ¡ˆå¼ï¼ˆ`data/prompts/*.md`ï¼‰ï¼Œä½†ç›®éŒ„ä¸å­˜åœ¨
- ç¼ºä¹ AI èª¿ç”¨æ—¥èªŒ

**è¨­è¨ˆæ±ºç­–ï¼š**
æ¡ç”¨ 4 å€‹ç¨ç«‹æ‡‰ç”¨çš„è¨­è¨ˆï¼Œå¯åŒæ™‚é–‹å•Ÿä¸¦æ’åˆ—åœ¨è¢å¹•ä¸Šï¼Œå¯¦ç¾å³æ™‚åé¥‹çš„é–‹ç™¼å·¥ä½œæµç¨‹ã€‚

## Goals / Non-Goals

### Goals
- å»ºç«‹ AI Agent è¨­å®šç®¡ç†ï¼ˆå®šç¾©ä¸åŒåŠ©æ‰‹çš„é…ç½®ï¼‰
- å»ºç«‹ AI Prompt ç®¡ç†ï¼ˆè³‡æ–™åº« CRUDï¼Œå–ä»£æª”æ¡ˆå¼ï¼‰
- å»ºç«‹ AI Log è¨˜éŒ„ï¼ˆé•·æœŸä¿ç•™ï¼Œæ”¯æ´åˆ†å€è¡¨ï¼‰
- è®“ç¾æœ‰å°è©±åŠŸèƒ½æ”¹ç”¨è³‡æ–™åº«çš„ Agent/Prompt è¨­å®š
- æä¾› 4 å€‹ç¨ç«‹æ‡‰ç”¨ï¼Œæ”¯æ´å¤šè¦–çª—ä¸¦åˆ—å·¥ä½œ

### Non-Goals
- ä¸å¯¦ä½œè¤‡é›œçš„ A/B æ¸¬è©¦åŠŸèƒ½
- ä¸å¯¦ä½œ prompt ç‰ˆæœ¬æ­·å²ï¼ˆç°¡åŒ–ç‚ºç›´æ¥è¦†è“‹ï¼‰
- æš«ä¸ä¿®æ”¹ `ai_chats` è¡¨çµæ§‹ï¼ˆå¾ŒçºŒå†è™•ç†ï¼‰

## Decisions

### 1. 4 å€‹ç¨ç«‹æ‡‰ç”¨è¨­è¨ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚                     â”‚
â”‚   ğŸ’¬ AI å°è©±        â”‚   ğŸ“ Prompt ç·¨è¼¯å™¨   â”‚
â”‚   ai-assistant      â”‚   prompt-editor     â”‚
â”‚                     â”‚                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     â”‚                     â”‚
â”‚   ğŸ¤– Agent è¨­å®š     â”‚   ğŸ“Š AI Log         â”‚
â”‚   agent-settings    â”‚   ai-log            â”‚
â”‚                     â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ‡‰ç”¨èªªæ˜ï¼š**

| æ‡‰ç”¨ | æª”æ¡ˆ | åŠŸèƒ½ |
|-----|------|-----|
| AI å°è©± | `ai-assistant.js` (ä¿®æ”¹) | å°è©±æ¸¬è©¦ï¼Œé¸æ“‡ Agent |
| Prompt ç·¨è¼¯å™¨ | `prompt-editor.js` (æ–°å¢) | Prompt CRUDï¼Œå³æ™‚ç·¨è¼¯ |
| Agent è¨­å®š | `agent-settings.js` (æ–°å¢) | Agent é…ç½®ï¼Œé—œè¯ Prompt |
| AI Log | `ai-log.js` (æ–°å¢) | æ—¥èªŒæŸ¥è©¢ï¼Œçµ±è¨ˆåˆ†æ |

### 2. è³‡æ–™åº«è¨­è¨ˆ

æ–°å¢ä»¥ä¸‹è³‡æ–™è¡¨ï¼š

```sql
-- AI Promptsï¼ˆå–ä»£æª”æ¡ˆå¼ç®¡ç†ï¼‰
CREATE TABLE ai_prompts (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(128) UNIQUE NOT NULL,      -- å”¯ä¸€è­˜åˆ¥å
    display_name VARCHAR(256),               -- é¡¯ç¤ºåç¨±
    category VARCHAR(64),                    -- åˆ†é¡ï¼ˆsystem, task, templateï¼‰
    content TEXT NOT NULL,                   -- Prompt å…§å®¹
    description TEXT,                        -- ä½¿ç”¨èªªæ˜
    variables JSONB,                         -- å¯ç”¨è®Šæ•¸èªªæ˜
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- AI Agents
CREATE TABLE ai_agents (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(64) UNIQUE NOT NULL,       -- å”¯ä¸€è­˜åˆ¥å
    display_name VARCHAR(128),               -- é¡¯ç¤ºåç¨±
    description TEXT,
    model VARCHAR(32) NOT NULL,              -- claude-haiku, claude-sonnet ç­‰
    system_prompt_id UUID REFERENCES ai_prompts(id) ON DELETE SET NULL,
    is_active BOOLEAN DEFAULT true,
    settings JSONB,                          -- é¡å¤–è¨­å®šï¼ˆä¿ç•™æ“´å±•ï¼‰
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- AI Logsï¼ˆåˆ†å€è¡¨ï¼Œé•·æœŸä¿ç•™ï¼‰
CREATE TABLE ai_logs (
    id UUID NOT NULL DEFAULT gen_random_uuid(),
    agent_id UUID REFERENCES ai_agents(id) ON DELETE SET NULL,
    prompt_id UUID REFERENCES ai_prompts(id) ON DELETE SET NULL,

    context_type VARCHAR(32),                 -- web-chat, linebot-group, system
    context_id VARCHAR(64),                   -- chat_id, group_id, job_id

    input_prompt TEXT NOT NULL,
    raw_response TEXT,
    parsed_response JSONB,

    model VARCHAR(32),
    success BOOLEAN DEFAULT true,
    error_message TEXT,
    duration_ms INTEGER,
    input_tokens INTEGER,
    output_tokens INTEGER,

    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    PRIMARY KEY (id, created_at)
) PARTITION BY RANGE (created_at);

-- åˆå§‹åˆ†å€ï¼ˆç•¶æœˆèˆ‡ä¸‹æœˆï¼‰
CREATE TABLE ai_logs_2025_01 PARTITION OF ai_logs
    FOR VALUES FROM ('2025-01-01') TO ('2025-02-01');
```

### 3. å„æ‡‰ç”¨è©³ç´°è¨­è¨ˆ

#### 3.1 AI å°è©±ï¼ˆä¿®æ”¹ç¾æœ‰ï¼‰

**æ”¹å‹•é»ï¼š**
- æ–°å°è©±æ™‚é¸æ“‡ Agentï¼ˆå–ä»£é¸æ“‡ prompt_nameï¼‰
- å¾ Agent å–å¾— model å’Œ system_prompt
- å°è©±èª¿ç”¨è‡ªå‹•è¨˜éŒ„åˆ° ai_logs

**ä»‹é¢èª¿æ•´ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI å°è©±                          [â”€][Ã—] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [+ æ–°å°è©±]  Agent: [web-chat-default â–¼] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å°è©±åˆ—è¡¨  â”‚  å°è©±å…§å®¹                    â”‚
â”‚          â”‚                              â”‚
â”‚ > å°è©±1  â”‚  ğŸ‘¤ ä½ å¥½                     â”‚
â”‚   å°è©±2  â”‚  ğŸ¤– ä½ å¥½ï¼æœ‰ä»€éº¼...          â”‚
â”‚          â”‚                              â”‚
â”‚          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚          â”‚  â”‚ è¼¸å…¥è¨Šæ¯...     [é€å‡º] â”‚   â”‚
â”‚          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.2 Prompt ç·¨è¼¯å™¨ï¼ˆæ–°å¢ï¼‰

**åŠŸèƒ½ï¼š**
- å·¦å´ Prompt åˆ—è¡¨ï¼ˆåˆ†é¡æ¨™ç±¤éæ¿¾ï¼‰
- å³å´ç·¨è¼¯å€ï¼ˆå¤šè¡Œæ–‡å­—ç·¨è¼¯å™¨ï¼‰
- å³æ™‚å„²å­˜

**ä»‹é¢ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Prompt ç·¨è¼¯å™¨                    [â”€][Ã—] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [+ æ–°å¢] [system â–¼] ğŸ” æœå°‹...          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Prompts  â”‚  åç¨±: web-chat-default      â”‚
â”‚          â”‚  åˆ†é¡: [system â–¼]            â”‚
â”‚ > defaultâ”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”‚
â”‚   code   â”‚  ä½ æ˜¯ä¸€å€‹å‹å–„çš„ AI åŠ©æ‰‹...    â”‚
â”‚   linebotâ”‚                              â”‚
â”‚          â”‚                              â”‚
â”‚          â”‚                              â”‚
â”‚          â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚          â”‚  [å„²å­˜] [åˆªé™¤]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.3 Agent è¨­å®šï¼ˆæ–°å¢ï¼‰

**åŠŸèƒ½ï¼š**
- Agent åˆ—è¡¨ï¼ˆé¡¯ç¤ºç‹€æ…‹ã€modelï¼‰
- Agent ç·¨è¼¯ï¼ˆé¸æ“‡ Promptã€Modelï¼‰
- å¿«é€Ÿæ¸¬è©¦åŠŸèƒ½

**ä»‹é¢ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Agent è¨­å®š                       [â”€][Ã—] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [+ æ–°å¢]                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Agents   â”‚  åç¨±: web-chat-default      â”‚
â”‚          â”‚  é¡¯ç¤º: é è¨­å°è©±åŠ©æ‰‹           â”‚
â”‚ â— defaultâ”‚  Model: [claude-sonnet â–¼]   â”‚
â”‚ â— code   â”‚  Prompt: [web-chat-defaultâ–¼] â”‚
â”‚ â—‹ test   â”‚  ç‹€æ…‹: [âœ“] å•Ÿç”¨              â”‚
â”‚          â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”‚
â”‚          â”‚  [æ¸¬è©¦] [å„²å­˜] [åˆªé™¤]         â”‚
â”‚          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          â”‚  æ¸¬è©¦å€ï¼š                     â”‚
â”‚          â”‚  è¼¸å…¥: [æ¸¬è©¦è¨Šæ¯...]         â”‚
â”‚          â”‚  è¼¸å‡º: ...                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.4 AI Logï¼ˆæ–°å¢ï¼‰

**åŠŸèƒ½ï¼š**
- æ—¥èªŒåˆ—è¡¨ï¼ˆæ™‚é–“ã€Agentã€æˆåŠŸ/å¤±æ•—ã€è€—æ™‚ï¼‰
- éæ¿¾åŠŸèƒ½ï¼ˆAgentã€context_typeã€æ—¥æœŸç¯„åœï¼‰
- è©³æƒ…æª¢è¦–ï¼ˆå®Œæ•´è¼¸å…¥è¼¸å‡ºï¼‰
- çµ±è¨ˆå¡ç‰‡

**ä»‹é¢ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI Log                           [â”€][Ã—] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Agent:[å…¨éƒ¨â–¼] é¡å‹:[å…¨éƒ¨â–¼] æ—¥æœŸ:[ä»Šå¤©â–¼] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ çµ±è¨ˆ: ä»Šæ—¥ 45 æ¬¡ | æˆåŠŸç‡ 98% | å¹³å‡ 1.2sâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ™‚é–“       Agent      é¡å‹    è€—æ™‚  ç‹€æ…‹â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ 14:32:01  default    web     1.1s  âœ“   â”‚
â”‚ 14:30:45  linebot    line    0.8s  âœ“   â”‚
â”‚ 14:28:12  default    web     2.3s  âœ—   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è©³æƒ…ï¼š                                  â”‚
â”‚ Input: ä½ å¥½ï¼Œè«‹å•...                    â”‚
â”‚ Output: ä½ å¥½ï¼æˆ‘æ˜¯...                   â”‚
â”‚ Tokens: 150 / 200                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. èˆ‡ç¾æœ‰ ai_chats çš„é—œä¿‚

**æš«ä¸ä¿®æ”¹ ai_chats è¡¨çµæ§‹**ï¼Œåœ¨æœå‹™å±¤æ•´åˆï¼š

```python
# ai_chat.py ä¿®æ”¹
async def send_message(chat_id, message, user_id):
    chat = await get_chat(chat_id)

    # å¾è³‡æ–™åº«å–å¾—å°æ‡‰çš„ Agent
    agent = await ai_manager.get_agent_by_name(chat.prompt_name)
    if not agent:
        agent = await ai_manager.get_default_agent()

    # èª¿ç”¨ AIï¼ˆä½¿ç”¨ Agent çš„è¨­å®šï¼Œè‡ªå‹•è¨˜éŒ„ Logï¼‰
    result = await ai_manager.call(
        agent=agent,
        message=message,
        context_type="web-chat",
        context_id=str(chat_id),
        history=chat.messages
    )

    return result
```

### 5. é è¨­è³‡æ–™

**é è¨­ Promptsï¼š**
```
ai_prompts:
â”œâ”€â”€ web-chat-default      # é è¨­å°è©± system prompt
â”œâ”€â”€ web-chat-code         # ç¨‹å¼ç¢¼åŠ©æ‰‹ system prompt
â”œâ”€â”€ linebot-group         # Line Bot ç¾¤çµ„å°è©±
â”œâ”€â”€ linebot-personal      # Line Bot å€‹äººåŠ©ç†
â””â”€â”€ system-task           # ç³»çµ±ä»»å‹™
```

**é è¨­ Agentsï¼š**
```
ai_agents:
â”œâ”€â”€ web-chat-default      # å‰ç«¯é è¨­å°è©±ï¼ˆå°æ‡‰èˆŠ prompt_name='default'ï¼‰
â”œâ”€â”€ web-chat-code         # å‰ç«¯ç¨‹å¼ç¢¼åŠ©æ‰‹ï¼ˆå°æ‡‰èˆŠ prompt_name='code-assistant'ï¼‰
â”œâ”€â”€ linebot-group         # Line Bot ç¾¤çµ„
â”œâ”€â”€ linebot-personal      # Line Bot å€‹äºº
â””â”€â”€ system-scheduler      # ç³»çµ±æ’ç¨‹ä»»å‹™
```

### 6. API è¨­è¨ˆ

```
/api/ai/
â”œâ”€â”€ prompts/               # Prompt CRUD
â”‚   â”œâ”€â”€ GET               # åˆ—è¡¨ï¼ˆæ”¯æ´ ?category= éæ¿¾ï¼‰
â”‚   â”œâ”€â”€ POST              # æ–°å¢
â”‚   â”œâ”€â”€ GET /{id}         # è©³æƒ…
â”‚   â”œâ”€â”€ PUT /{id}         # æ›´æ–°
â”‚   â””â”€â”€ DELETE /{id}      # åˆªé™¤
â”œâ”€â”€ agents/                # Agent CRUD
â”‚   â”œâ”€â”€ GET               # åˆ—è¡¨
â”‚   â”œâ”€â”€ POST              # æ–°å¢
â”‚   â”œâ”€â”€ GET /{id}         # è©³æƒ…
â”‚   â”œâ”€â”€ GET /by-name/{name}  # ä¾åç¨±æŸ¥è©¢
â”‚   â”œâ”€â”€ PUT /{id}         # æ›´æ–°
â”‚   â””â”€â”€ DELETE /{id}      # åˆªé™¤
â”œâ”€â”€ logs/                  # AI Log æŸ¥è©¢
â”‚   â”œâ”€â”€ GET               # åˆ—è¡¨ï¼ˆåˆ†é ã€éæ¿¾ï¼‰
â”‚   â”œâ”€â”€ GET /{id}         # è©³æƒ…
â”‚   â””â”€â”€ GET /stats        # çµ±è¨ˆ
â””â”€â”€ test/                  # æ¸¬è©¦åŠŸèƒ½
    â””â”€â”€ POST              # æ¸¬è©¦ agent
```

## Risks / Trade-offs

### Risks
1. **Log è³‡æ–™é‡å¤§** - é•·æœŸä¿ç•™å¯èƒ½ä½”ç”¨å¤§é‡ç©ºé–“
   - ç·©è§£ï¼šä½¿ç”¨åˆ†å€è¡¨ï¼Œå¯æŒ‰æœˆæ¸…ç†èˆŠåˆ†å€
2. **é·ç§»è¤‡é›œåº¦** - ç¾æœ‰å°è©±éœ€è¦æ˜ å°„åˆ°æ–°çš„ Agent/Prompt
   - ç·©è§£ï¼šä¿æŒå‘å¾Œç›¸å®¹ï¼ŒèˆŠ prompt_name è‡ªå‹•æ˜ å°„

### Trade-offs
- **4 å€‹æ‡‰ç”¨ vs 1 å€‹**ï¼šé¸æ“‡éˆæ´»æ€§ï¼ŒçŠ§ç‰²éƒ¨åˆ†ç¨‹å¼ç¢¼å…±ç”¨
- **æ¼¸é€²å¼æ•´åˆ**ï¼šæš«ä¸ä¿®æ”¹ ai_chats è¡¨ï¼Œæ¸›å°‘é¢¨éšª
- **ç°¡å–®ç®¡ç†**ï¼šä¸å¯¦ä½œ prompt ç‰ˆæœ¬æ­·å²ï¼Œé™ä½è¤‡é›œåº¦

## Migration Plan

1. å»ºç«‹ Alembic migrationï¼ˆai_prompts, ai_agents, ai_logsï¼‰
2. å¯¦ä½œå¾Œç«¯ API
3. å»ºç«‹é è¨­ Prompts å’Œ Agents
4. æ–°å¢ 3 å€‹å‰ç«¯æ‡‰ç”¨ï¼ˆPrompt ç·¨è¼¯å™¨ã€Agent è¨­å®šã€AI Logï¼‰
5. ä¿®æ”¹ç¾æœ‰ AI å°è©±æ‡‰ç”¨æ”¯æ´ Agent é¸æ“‡
6. ä¿®æ”¹ ai_chat æœå‹™ä½¿ç”¨æ–°çš„ Agent/Prompt
7. åœ¨ desktop.js è¨»å†Šæ–°æ‡‰ç”¨
8. æ¸¬è©¦æ•´åˆåŠŸèƒ½

## Open Questions

1. ~~AI åŠ©æ‰‹èˆ‡ç®¡ç†æ˜¯å¦æ•´åˆï¼Ÿ~~ å·²ç¢ºèªï¼šåˆ†æˆ 4 å€‹ç¨ç«‹æ‡‰ç”¨
2. ~~ai_chats è¡¨è™•ç†æ–¹å¼ï¼Ÿ~~ å·²ç¢ºèªï¼šæš«ä¸ä¿®æ”¹ï¼Œæœå‹™å±¤æ•´åˆ
